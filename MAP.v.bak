module MAP(
	input						clk,
	input						rstn,
	input				[31:0]		A,
	input				[31:0]		B,
	input				[31:0]		C,
	input				[2:0]			cont,
	output 			[31:0]		out,
	/*测试用例*/
	output			[73:0]		sh,
	output			[47:0]		Carry1,
	output			[47:0]		Sum1
);
	wire				[13:0]		e_a;
	wire				[13:0]		e_b;
	wire				[13:0]		e_c;
	wire				[11:0]		sh_num;
	wire				[23:0]		m_c;
	wire				[23:0]		m_a;
	wire				[23:0]		m_b;
	wire				[75:0]		sh_reg;
	wire				[75:0]		sh_reg_out;
	/*1-2 level*/
	wire								S_A_1t2;
	wire								S_B_1t2;
	wire								S_C_1t2;
	wire								S_A_H_1t2;
	wire								S_B_H_1t2;
	wire								S_C_H_1t2;
	wire				[3:0]			trap_0_1t2;
	wire				[2:0]			trap_ans_0_1t2;
	wire				[2:0]			trap_ans_1_1t2;
	wire				[3:0]			trap_1_1t2;
	wire				[2:0]			cont_1t2;
	/*2-3 level*/
	wire								S_A_2t3;
	wire								S_B_2t3;
	wire								S_C_2t3;
	wire								S_A_H_2t3;
	wire								S_B_H_2t3;
	wire								S_C_H_2t3;
	wire				[3:0]			trap_0_2t3;
	wire				[2:0]			trap_ans_0_2t3;
	wire				[2:0]			trap_ans_1_2t3;
	wire				[3:0]			trap_1_2t3;
	wire				[2:0]			cont_2t3;
	wire				[575:0]		M_out_plain_2t3;
	wire				[75:0]		sh_reg_2t3;
	wire				[11:0]		E_2t3;
	wire				[11:0]		d_2t3;
	/*3_1-3_2 level*/
	wire								S_A_3_1t3_2;
	wire								S_B_3_1t3_2;
	wire								S_C_3_1t3_2;
	wire								S_A_H_3_1t3_2;
	wire								S_B_H_3_1t3_2;
	wire								S_C_H_3_1t3_2;
	wire				[3:0]			trap_0_3_1t3_2;
	wire				[2:0]			trap_ans_0_3_1t3_2;
	wire				[2:0]			trap_ans_1_3_1t3_2;
	wire				[3:0]			trap_1_3_1t3_2;
	wire				[73:0]		sh_rev_reg_3_1t3_2;
	wire				[3:0]			sti_3_1t3_2;
	wire 				[287:0]		Level3_lin_3_1t3_2;
	wire				[11:0]		d_3_1t3_2;
	wire				[11:0]		E_3_1t3_2;
	wire				[2:0]			cont3_1t3_2;
	/*3_2-4 level*/
	//控制信号
	wire								S_A_3_2t4;
	wire								S_B_3_2t4;
	wire								S_C_3_2t4;
	wire								S_A_H_3_2t4;
	wire								S_B_H_3_2t4;
	wire								S_C_H_3_2t4;
	wire				[3:0]			trap_0_3_2t4;
	wire				[2:0]			trap_ans_0_3_2t4;
	wire				[2:0]			trap_ans_1_3_2t4;
	wire				[3:0]			trap_1_3_2t4;
	wire				[11:0]		d_3_2t4;
	wire				[11:0]		E_3_2t4;
	wire				[2:0]			cont_3_2t4;
	//数据信号
	wire				[3:0]			sti_3_2t4;
	wire 				[47:0]		Carry_3_2t4;
	wire				[73:0]		sh_rev_reg_3_2t4;
	wire				[47:0]		Sum_3_2t4;
	/*4 - 5 level*/
	wire								S_A_4t5;
	wire								S_B_4t5;
	wire								S_C_4t5;
	wire								S_A_H_4t5;
	wire								S_B_H_4t5;
	wire								S_C_H_4t5;
	wire				[3:0]			trap_0_4t5;
	wire				[2:0]			trap_ans_0_4t5;
	wire				[2:0]			trap_ans_1_4t5;
	wire				[3:0]			trap_1_4t5;
	wire				[2:0]			cont_4t5;
	wire				[73:0]		p_reg_4t5;
	wire				[9:0]			sh_num_4t5;
	wire				[1:0]			esh_4t5;
	wire				[11:0]		d_4t5;
	wire								s2_4t5;
	wire								s2h_4t5;
	wire				[1:0]			revising_4t5;
	wire				[11:0]		E_4t5;
	/*5 - 6 level*/
	wire								S_A_5t6;
	wire								S_B_5t6;
	wire								S_C_5t6;
	wire								S_A_H_5t6;
	wire								S_B_H_5t6;
	wire								S_C_H_5t6;
	wire				[3:0]			trap_0_5t6;
	wire				[2:0]			trap_ans_0_5t6;
	wire				[2:0]			trap_ans_1_5t6;
	wire				[3:0]			trap_1_5t6;
	wire				[2:0]			cont_5t6;
	wire				[73:0]		sh_rev_reg_5t6;
	wire				[3:0]			sti_5t6;
	wire				[47:0]		Carry_5t6;
	wire				[47:0]		Sum_5t6;
	wire								s_a;
	wire								s_a_h;
	wire 								s_b;
	wire								s_b_h;
	wire								s_c_h;
	wire								s_c;
	/*test*/
	
	
	Pretreatment pretreatment(
		.clk										(clk), 
		.rstn										(rstn),
		.A											(A),
		.B											(B),
		.C											(C),
		.cont										(cont),
		.trap_0									(trap_0_1t2),
		.trap_1									(trap_1_1t2),
		.trap_ans_0								(trap_ans_0_1t2),
		.trap_ans_1								(trap_ans_1_1t2),
		.E_A										(e_a),
		.E_B										(e_b),
		.E_C										(e_c),
		.M_C										(m_c),
		.M_A										(m_a),
		.M_B										(m_b),
		.S_A										(s_a),
		.S_A_H									(s_a_h),
		.S_B										(s_b),
		.S_B_H									(s_b_h),
		.S_C										(s_c),
		.S_C_H									(s_c_h),
		.con_state								(cont_1t2)
	);
	T2_stage	t2_stage(
		.clk										(clk),
		.rstn                            (rstn),
		.M_A										(m_a),
		.M_B										(m_b),
		.M_C										(m_c),
		.trap_T1_0								(trap_0_1t2),
		.trap_T1_1								(trap_1_1t2),
		.E_A										(e_a),
		.E_B										(e_b),
		.E_C										(e_c),
		.S_A_T1									(s_a),
		.S_B_T1									(s_b),
		.S_C_T1									(s_c),
		.S_A_H_T1								(s_a_h),
		.S_B_H_T1								(s_b_h),
		.S_C_H_T1								(s_c_h),
		.cont										(cont_1t2),
		.trap_ans_T1_0							(trap_ans_0_1t2),
		.trap_ans_T1_1							(trap_ans_1_1t2),
		.cont_T2									(cont_2t3),
		.S_A_T2									(S_A_2t3),
		.S_B_T2									(S_B_2t3),
		.S_C_T2									(S_C_2t3),
		.S_A_H_T2								(S_A_H_2t3),
		.S_B_H_T2								(S_B_H_2t3),
		.S_C_H_T2								(S_C_H_2t3),
		.sh_reg									(sh_reg_2t3),
		.M_out_plain							(M_out_plain_2t3),
		.trap_T2_0								(trap_0_2t3),
		.trap_ans_T2_0							(trap_ans_0_2t3),
		.trap_T2_1								(trap_1_2t3),
		.trap_ans_T2_1							(trap_ans_1_2t3),
		.E_T2										(E_2t3),
		.d_T2										(d_2t3)
	); 
	T3_1_stage t3_1_stage(
		.clk										(clk),
		.rstn										(rstn),
		.cont										(cont_2t3),
		.M_out_plain_in						(M_out_plain_2t3),
		.d_T2										(d_2t3),
		.sh_reg_T2								(sh_reg_2t3),
		.S_A_T2									(S_A_2t3),
		.S_B_T2									(S_B_2t3),
		.S_C_T2									(S_C_2t3),
		.S_A_H_T2								(S_A_H_2t3),
		.S_B_H_T2								(S_B_H_2t3),
		.S_C_H_T2								(S_C_H_2t3),
		.trap_T2_0								(trap_0_2t3),
		.trap_T2_1								(trap_1_2t3),
		.trap_ans_T2_0							(trap_ans_0_2t3),
		.trap_ans_T2_1							(trap_ans_1_2t3),
		.E_T2										(E_2t3),
		//输出
		.S_A_T3_1								(S_A_3_1t3_2),
		.S_B_T3_1								(S_B_3_1t3_2),
		.S_C_T3_1								(S_C_3_1t3_2),
		.S_A_H_T3_1								(S_A_H_3_1t3_2),
		.S_B_H_T3_1								(S_B_H_3_1t3_2),
		.S_C_H_T3_1								(S_C_H_3_1t3_2),
		.trap_T3_1_0							(trap_0_3_1t3_2),
		.trap_T3_1_1							(trap_1_3_1t3_2),
		.trap_ans_T3_1_0						(trap_ans_0_3_1t3_2),
		.trap_ans_T3_1_1						(trap_ans_1_3_1t3_2),
		.sh_rev_reg								(sh_rev_reg_3_1t3_2),
		.sti										(sti_3_1t3_2),
		.d_T3_1									(d_3_1t3_2),
		.E_T3_1									(E_3_1t3_2),
		.cont_T3_1								(cont3_1t3_2),
		.Level3_out								(Level3_lin_3_1t3_2)
	);
		T3_2_stage t3_2_stage(
		.clk										(clk),
		.rstn										(rstn),
		.cont_T3_1								(cont3_1t3_2),
		.sh_rev_reg_in							(sh_rev_reg_3_1t3_2),
		.S_A_T3_1								(S_A_3_1t3_2),
		.S_B_T3_1								(S_B_3_1t3_2),
		.S_C_T3_1								(S_C_3_1t3_2),
		.S_A_H_T3_1								(S_A_H_3_1t3_2),
		.S_B_H_T3_1								(S_B_H_3_1t3_2),
		.S_C_H_T3_1								(S_C_H_3_1t3_2),
		.trap_T3_1_0							(trap_0_3_1t3_2),
		.trap_T3_1_1							(trap_1_3_1t3_2),
		.trap_ans_T3_1_0						(trap_ans_0_3_1t3_2),
		.trap_ans_T3_1_1						(trap_ans_1_3_1t3_2),
		.E_T3_1									(E_3_1t3_2),
		.d_T3_1									(d_3_1t3_2),
		.Level3_in								(Level3_lin_3_1t3_2),
		.sti										(sti_3_1t3_2),
		//输出
		.S_A_T3_2								(S_A_3_2t4),
		.S_B_T3_2								(S_B_3_2t4),
		.S_C_T3_2								(S_C_3_2t4),
		.S_A_H_T3_2								(S_A_H_3_2t4),
		.S_B_H_T3_2								(S_B_H_3_2t4),
		.S_C_H_T3_2								(S_C_H_3_2t4),
		.trap_T3_2_0							(trap_0_3_2t4),
		.trap_T3_2_1							(trap_1_3_2t4),
		.trap_ans_T3_2_0						(trap_ans_0_3_2t4),
		.trap_ans_T3_2_1						(trap_ans_1_3_2t4),
		.d_T3_2									(d_3_2t4),
		.E_T3_2									(E_3_2t4),
		.cont_T3_2								(cont_3_2t4),
		.sti_out									(sti_3_2t3),
		.Carry									(Carry_3_2t4),
		.Sum										(Sum_3_2t4),
		.sh_rev_reg_out						(sh_rev_reg_3_2t4),
	);
	T4_stage t4_stage(
		.clk										(clk),
		.rstn										(rstn),
		.cont_T3									(cont_3_2t4),
		.sh_reg									(sh_rev_reg_3_2t4),
		.E_T3										(E_3_2t4),
		.Sum										(Sum_3_2t4),
		.Carry									(Carry_3_2t4),
		.S_A_T3									(S_A_3_2t4),
		.S_B_T3									(S_B_3_2t4),
		.S_C_T3									(S_C_3_2t4),
		.S_A_H_T3								(S_A_H_3_2t4),
		.S_B_H_T3								(S_B_H_3_2t4),
		.S_C_H_T3								(S_C_H_3_2t4),
		.trap_T3_0								(trap_0_3_2t4),
		.trap_T3_1								(trap_1_3_2t4),
		.trap_ans_T3_0							(trap_ans_0_3_2t4),
		.trap_ans_T3_1							(trap_ans_1_3_2t4),
		.d_T3										(d_3t4),
		.S_A_T4									(S_A_4t5),
		.S_B_T4									(S_B_4t5),
		.S_C_T4									(S_C_4t5),
		.S_A_H_T4								(S_A_H_4t5),
		.S_B_H_T4								(S_B_H_4t5),
		.S_C_H_T4								(S_C_H_4t5),
		.trap_T4_0								(trap_0_4t5),
		.trap_T4_1								(trap_1_4t5),
		.trap_ans_T4_0							(trap_ans_0_4t5),
		.trap_ans_T4_1							(trap_ans_1_4t5),
		.cont_T4									(cont_4t5),
		.p_reg									(p_reg_4t5),
		.esh										(esh_4t5),
		.d_T4										(d_4t5),
		.sh_num									(sh_num_4t5),
		.s2_T4									(s2_4t5),
		.s2h_T4									(s2h_4t5),
		.E_T4										(E_4t5),
		.revising_T4							(revising_4t5)
	);
	T5_stage t5_stage(
		.clk										(clk),
		.rstn										(rstn),
		.cont_T4									(cont_4t5),
		.E_T4										(E_4t5),
		.p_reg									(p_reg_4t5),
		.S_A_T4									(S_A_4t5),
		.S_B_T4									(S_B_4t5),
		.S_C_T4									(S_C_4t5),
		.S_A_H_T4								(S_A_H_4t5),
		.S_B_H_T4								(S_B_H_4t5),
		.S_C_H_T4								(S_C_H_4t5),
		.trap_T4_0								(trap_0_4t5),
		.trap_T4_1								(trap_1_4t5),
		.trap_ans_T4_0							(trap_ans_0_4t5),
		.trap_ans_T4_1							(trap_ans_1_4t5),
		.sh_num_T4									(sh_num_4t5),
		.revising_T4							(revising_4t5),
		.esh_T4									(esh_4t5),
		.d_T4										(d_4t5),
		.s2_T4									(s2_4t5),
		.s2h_T4									(s2h_4t5),
		.calculation							(out)
	);
	//给输出先存入
endmodule

	
	
		
		
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
